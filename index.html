<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Who Would Win? ‚Äî Player Battle + Quiz</title>
  <style>
    :root{
      --bg:#0b0f19;
      --text:#eaf1ff;
      --muted:#a9b7d1;
      --accent:#7cf7c2;
      --accent2:#7cc7ff;
      --danger:#ff6b81;
      --warn:#ffcc66;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius:18px;
      --border: 1px solid rgba(255,255,255,.08);
      --glow: 0 0 0 2px rgba(124,247,194,.10), 0 0 25px rgba(124,247,194,.08);
      --glow2: 0 0 0 2px rgba(124,199,255,.10), 0 0 25px rgba(124,199,255,.08);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--font);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(124,199,255,.18), transparent 65%),
        radial-gradient(900px 600px at 80% 20%, rgba(124,247,194,.14), transparent 60%),
        radial-gradient(700px 500px at 60% 90%, rgba(255,204,102,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{
      padding:18px 16px 10px;
      max-width:1100px;
      margin:0 auto;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,247,194,.95), rgba(124,199,255,.95));
      display:grid;place-items:center;
      color:#07111f;
      box-shadow: var(--shadow);
      font-weight:900;
    }
    h1{margin:0;font-size:18px;line-height:1.15;}
    .sub{margin:2px 0 0;color:var(--muted);font-size:12px;}
    .pillbar{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      font-size:12px;padding:8px 10px;border-radius:999px;
      border: var(--border); background: rgba(255,255,255,.04);
      color:var(--muted); user-select:none;
    }
    main{
      max-width:1100px;
      margin:0 auto;
      padding: 10px 16px 60px;
      display:grid;
      gap:14px;
    }
    .grid{display:grid; grid-template-columns: 1.35fr .65fr; gap:14px;}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      header{flex-direction:column; align-items:flex-start}
      .pillbar{justify-content:flex-start}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: rgba(16,26,43,.35);
    }
    .card .hd h2{margin:0;font-size:14px;letter-spacing:.2px;}
    .card .hd p{margin:4px 0 0;color:var(--muted);font-size:12px;line-height:1.35;}
    .card .bd{ padding:14px; }

    .controls{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .leftControls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .rightControls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .select, .search{
      border-radius: 12px;
      border: var(--border);
      background: rgba(14,21,36,.55);
      color: var(--text);
      padding:10px 12px;
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .search{min-width:240px}
    @media (max-width:520px){ .search{min-width:0; width:100%} }

    .btn{
      border-radius: 14px;
      border: var(--border);
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      color: var(--text);
      background: rgba(255,255,255,.06);
      transition: transform .08s ease, background .2s ease, filter .2s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10) }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background: linear-gradient(135deg, rgba(124,247,194,.95), rgba(124,199,255,.95)); color:#07111f; border:0; }
    .btn.primary:hover{ filter: brightness(1.05) }
    .btn.danger{ background: rgba(255,107,129,.12); border-color: rgba(255,107,129,.25) }
    .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none }
    .btn.small{ padding:9px 10px; border-radius: 12px; font-size:12px; }

    .hint{font-size:12px;color: var(--muted);}

    .animalGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .animalGrid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 720px){ .animalGrid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 420px){ .animalGrid{ grid-template-columns: 1fr; } }

    .animalCard{
      border-radius: 18px;
      border: var(--border);
      background:
        radial-gradient(160px 90px at 20% 10%, rgba(124,247,194,.20), transparent 70%),
        radial-gradient(160px 90px at 80% 10%, rgba(124,199,255,.18), transparent 70%),
        rgba(14,21,36,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      padding:12px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      position:relative;
      overflow:hidden;
    }
    .animalCard:hover{ transform: translateY(-2px); filter: brightness(1.05) }
    .animalCard.selectedP1{ box-shadow: var(--shadow), var(--glow); border-color: rgba(124,247,194,.35) }
    .animalCard.selectedP2{ box-shadow: var(--shadow), var(--glow2); border-color: rgba(124,199,255,.35) }
    .animalTop{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;}
    .emoji{
      font-size:34px; line-height:1;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));
    }
    .tag{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border: var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .animalName{font-weight:900;font-size:13px;margin:0 0 4px;}
    .move{margin:0;font-size:12px;color: var(--muted);}
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
      margin-top:10px;
    }
    .stat{
      border-radius: 12px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:8px;
      text-align:center;
    }
    .stat b{ display:block; font-size:12px }
    .stat span{ font-size:10px; color:var(--muted) }

    /* Battle */
    .battleWrap{display:grid;gap:12px;}
    .arena{
      border-radius: 20px;
      border: var(--border);
      background:
        radial-gradient(600px 220px at 50% 0%, rgba(124,199,255,.12), transparent 60%),
        radial-gradient(600px 220px at 50% 100%, rgba(124,247,194,.10), transparent 60%),
        rgba(14,21,36,.45);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .arenaRow{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:10px;
      align-items:start;
    }
    .fighter{
      border-radius: 18px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:12px;
      display:grid;
      gap:10px;
      min-height:122px;
      position:relative;
      overflow:hidden;
    }
    .fighter.p1{ box-shadow: inset 0 0 0 2px rgba(124,247,194,.08); }
    .fighter.p2{ box-shadow: inset 0 0 0 2px rgba(124,199,255,.08); }
    .fighterTop{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .fighterName{display:flex; align-items:center; gap:10px; font-weight:900;}
    .fighterName .emoji{ font-size:40px }
    .mini{font-size:11px;color:var(--muted);font-weight:800;}
    .hpbar{
      height:14px; background: rgba(255,255,255,.06);
      border-radius: 999px; border: var(--border);
      overflow:hidden; position:relative;
    }
    .hpfill{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, rgba(124,247,194,.95), rgba(124,199,255,.85));
      transition: width .25s ease;
    }
    .hptext{display:flex; justify-content:space-between; font-size:11px; color:var(--muted);}
    .vs{
      font-weight:1000; letter-spacing:.5px;
      color: rgba(255,255,255,.75);
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
      margin-top:16px;
    }
    .log{
      border-radius: 18px;
      border: var(--border);
      background: rgba(0,0,0,.18);
      padding:12px;
      height: 210px;
      overflow:auto;
      font-size:12px;
      line-height:1.35;
    }
    .log .entry{
      padding:10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      margin-bottom:10px;
    }
    .log .entry b{ color: var(--text) }
    .log .meta{ color: var(--muted); margin-top:6px; }

    .hit{ animation: hit .35s ease; }
    @keyframes hit{
      0%{ transform: translateX(0) }
      30%{ transform: translateX(-6px) rotate(-.4deg) }
      60%{ transform: translateX(6px) rotate(.4deg) }
      100%{ transform: translateX(0) }
    }

    .movePanel{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 780px){ .movePanel{ grid-template-columns: 1fr; } }

    .movesBox{
      border-radius: 18px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:12px;
    }
    .movesBox h3{
      margin:0 0 10px;
      font-size:13px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .moveBtns{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 420px){ .moveBtns{ grid-template-columns: 1fr; } }

    .popFact{
      position: absolute;
      left: 50%;
      top: 14px;
      transform: translateX(-50%);
      width: min(720px, calc(100% - 24px));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(16,26,43,.92);
      box-shadow: var(--shadow);
      padding: 12px 14px;
      z-index: 50;
      display:none;
    }
    .popFact.show{
      display:block;
      animation: popIn .18s ease;
    }
    @keyframes popIn{
      from{ opacity:0; transform: translateX(-50%) translateY(-6px) scale(.98); }
      to{ opacity:1; transform: translateX(-50%) translateY(0) scale(1); }
    }
    .popFact .t{
      font-weight:1000;
      margin-bottom:6px;
      letter-spacing:.2px;
    }
    .popFact .f{
      color: rgba(255,255,255,.88);
      font-size: 13px;
      line-height:1.35;
    }

    /* Quiz */
    .quizQ{
      border-radius: 18px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:12px;
      margin-bottom:12px;
    }
    .quizQ h3{ margin:0 0 10px; font-size:13px; }
    .options{ display:grid; gap:8px; }
    .opt{
      border-radius: 14px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:10px;
      cursor:pointer;
      font-size:12px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .opt:hover{ background: rgba(255,255,255,.06) }
    .opt:active{ transform: translateY(1px) }
    .opt.correct{ border-color: rgba(124,247,194,.45); background: rgba(124,247,194,.10) }
    .opt.wrong{ border-color: rgba(255,107,129,.45); background: rgba(255,107,129,.10) }
    .quizFooter{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-top:8px;
    }

    .toast{
      position: fixed;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16,26,43,.92);
      border: var(--border);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 12px;
      display:none;
      z-index: 999;
    }
    .toast.show{ display:block; animation: toastPop .18s ease }
    @keyframes toastPop{ from{ transform: translateX(-50%) scale(.96); opacity:.0 } to{ transform: translateX(-50%) scale(1); opacity:1 } }

    footer{
      max-width:1100px;
      margin:0 auto;
      padding: 0 16px 22px;
      color: var(--muted);
      font-size: 11px;
    }
    .tinyNote{opacity:.85;line-height:1.45;}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">WW</div>
    <div>
      <h1>Who Would Win? <span style="color:rgba(255,255,255,.6);font-weight:800">Player Battle + Quiz</span></h1>
      <div class="sub">Pick two animals ‚Üí take turns using moves ‚Üí read fun facts ‚Üí quiz ‚Üí back home</div>
    </div>
  </div>
  <div class="pillbar">
    <div class="pill">üéÆ Player-controlled turns</div>
    <div class="pill">üß© 4 moves each</div>
    <div class="pill">ü¶Å 35 animals</div>
    <div class="pill">üß† Quiz from facts shown</div>
  </div>
</header>

<main class="grid">
  <section class="card">
    <div class="hd">
      <div>
        <h2 id="stageTitle">Stage 1: Choose animals</h2>
        <p id="stageDesc">Player 1 picks first, then Player 2. Every animal has 4 moves in battle.</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <button id="resetBtn" class="btn danger">Restart</button>
      </div>
    </div>

    <div class="bd">
      <!-- Selection -->
      <div id="selectionView">
        <div class="controls">
          <div class="leftControls">
            <select id="categorySelect" class="select">
              <option value="All">All categories</option>
            </select>
            <input id="searchInput" class="search" placeholder="Search animals‚Ä¶ (tiger, shark, falcon‚Ä¶)" />
          </div>
          <div class="rightControls">
            <span class="hint" id="pickHint">Now picking: <b>Player 1</b></span>
            <button id="randomBtn" class="btn">üé≤ Random pick</button>
          </div>
        </div>

        <div class="animalGrid" id="animalGrid"></div>
      </div>

      <!-- Battle -->
      <div id="battleView" style="display:none">
        <div class="battleWrap">
          <div class="arena" id="arena">
            <div class="popFact" id="popFact">
              <div class="t" id="popTitle">Fun Fact</div>
              <div class="f" id="popBody">‚Ä¶</div>
            </div>

            <div class="arenaRow">
              <div class="fighter p1" id="fighter1"></div>
              <div class="vs">VS</div>
              <div class="fighter p2" id="fighter2"></div>
            </div>

            <div style="height:12px"></div>

            <div class="movePanel">
              <div class="movesBox">
                <h3>
                  <span>Player 1 moves</span>
                  <span class="tag" id="p1TurnTag">Waiting‚Ä¶</span>
                </h3>
                <div class="moveBtns" id="p1Moves"></div>
              </div>

              <div class="movesBox">
                <h3>
                  <span>Player 2 moves</span>
                  <span class="tag" id="p2TurnTag">Waiting‚Ä¶</span>
                </h3>
                <div class="moveBtns" id="p2Moves"></div>
              </div>
            </div>
          </div>

          <div class="controls">
            <div class="leftControls">
              <button id="startBattleBtn" class="btn primary">Start Battle!</button>
              <button id="homeBtn" class="btn" style="display:none">üè† Back to Home</button>
            </div>
            <div class="rightControls">
              <span class="hint" id="turnHint">Ready‚Ä¶</span>
            </div>
          </div>

          <div class="log" id="battleLog" aria-live="polite"></div>
        </div>
      </div>

      <!-- Quiz -->
      <div id="quizView" style="display:none">
        <div id="quizWrap"></div>
        <div class="quizFooter">
          <div class="hint" id="quizScoreHint">Score: 0 / 4</div>
          <button id="quizHomeBtn" class="btn primary" disabled>Back to Home</button>
        </div>
      </div>
    </div>
  </section>

  <aside class="card">
    <div class="hd">
      <div>
        <h2>Status</h2>
        <p>Turn-based: click a move button to attack. Fun facts pop up for readability.</p>
      </div>
    </div>
    <div class="bd">
      <div class="card" style="background:rgba(255,255,255,.02); box-shadow:none; border:var(--border)">
        <div class="bd" style="display:grid;gap:10px">
          <div class="hint"><b>Damage idea:</b> move power √ó attacker stats with a matchup bonus vs opponent.</div>
          <div class="hint"><b>Quiz:</b> pulled from the fun facts shown during THIS battle.</div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="background:rgba(255,255,255,.02); box-shadow:none; border:var(--border)">
        <div class="bd" style="display:grid;gap:10px">
          <div class="hint"><b>Players:</b></div>
          <div class="hint" id="picksSummary">Player 1: ‚Äî<br/>Player 2: ‚Äî</div>
        </div>
      </div>
    </div>
  </aside>
</main>

<div class="toast" id="toast"></div>

<footer>
  <div class="tinyNote">
    Tip: Want even more animals? Add more entries in the DATA section. Each animal gets 4 moves automatically.
  </div>
</footer>

<script>
/* =========================================
   DATA
   - Each animal has stats (1..10)
   - Each animal has a PRIMARY signature move + fun fact
   - We auto-generate 3 more moves so every animal has 4 total moves
   ========================================= */

const ANIMALS = [
  // LAND
  mkAnimal("Tiger","Land","üêØ", {size:7,str:9,spd:7}, "Pounce & Bite", 1.10, "Tigers can leap forward several meters when they pounce!"),
  mkAnimal("Lion","Land","ü¶Å", {size:8,str:9,spd:6}, "Roaring Rush", 1.05, "A lion‚Äôs roar can be heard from several kilometers away."),
  mkAnimal("Elephant","Land","üêò", {size:10,str:10,spd:4}, "Trunk Slam", 1.00, "Elephants use their trunks like a super-tool for smelling, grabbing, and spraying water."),
  mkAnimal("Cheetah","Land","üêÜ", {size:6,str:6,spd:10}, "Lightning Sprint", 1.05, "Cheetahs are famous for super-fast sprints (in short bursts)."),
  mkAnimal("Gorilla","Land","ü¶ç", {size:8,str:10,spd:5}, "Chest-Beat Crush", 1.05, "Gorillas communicate with sounds, gestures, and facial expressions."),
  mkAnimal("Gray Wolf","Land","üê∫", {size:6,str:7,spd:7}, "Pack Tactics", 1.00, "Wolves are social and often work together as a pack."),
  mkAnimal("Brown Bear","Land","üêª", {size:9,str:9,spd:5}, "Bear Hug Bash", 1.00, "Bears can have an excellent sense of smell."),
  mkAnimal("Moose","Land","ü´é", {size:9,str:8,spd:5}, "Antler Charge", 0.98, "Moose can be surprisingly quick for their size."),
  mkAnimal("Kangaroo","Land","ü¶ò", {size:6,str:7,spd:8}, "Boomer Kick", 1.02, "Kangaroos use powerful hind legs for hopping and kicking."),
  mkAnimal("Rhino","Land","ü¶è", {size:9,str:9,spd:6}, "Horn Rush", 1.00, "Rhino skin can look armor-like, but it‚Äôs still sensitive."),
  mkAnimal("Hippo","Land","ü¶õ", {size:9,str:9,spd:6}, "River Ram", 1.02, "Hippos spend lots of time in water to stay cool."),
  mkAnimal("Zebra","Land","ü¶ì", {size:6,str:5,spd:7}, "Stripe Sprint", 0.93, "Zebra stripes are unique‚Äîlike fingerprints."),
  mkAnimal("Polar Bear","Land","üêª‚Äç‚ùÑÔ∏è", {size:9,str:9,spd:6}, "Ice Breaker", 1.03, "Polar bears have thick fur and fat to handle cold climates."),
  mkAnimal("Honey Badger","Land","ü¶°", {size:4,str:7,spd:6}, "Fearless Frenzy", 1.00, "Honey badgers are famous for being very tough and bold."),
  mkAnimal("Giraffe","Land","ü¶í", {size:10,str:7,spd:6}, "Neck Swing", 0.98, "Giraffes have long necks to reach high leaves."),

  // OCEAN
  mkAnimal("Great White Shark","Ocean","ü¶à", {size:9,str:9,spd:7}, "Power Bite", 1.08, "Sharks have rows of teeth and can replace lost teeth over time."),
  mkAnimal("Orca","Ocean","üêã", {size:9,str:9,spd:7}, "Wave Ram", 1.06, "Orcas are actually dolphins (the biggest kind)."),
  mkAnimal("Giant Squid","Ocean","ü¶ë", {size:8,str:8,spd:6}, "Ink Cloud", 1.03, "Many squids can release ink to confuse predators."),
  mkAnimal("Sea Turtle","Ocean","üê¢", {size:6,str:5,spd:5}, "Shell Smash", 0.92, "Sea turtles travel long distances between feeding areas and nesting beaches."),
  mkAnimal("Dolphin","Ocean","üê¨", {size:6,str:6,spd:8}, "Echo Dash", 1.00, "Dolphins use echolocation‚Äîsound‚Äîto help navigate and find food."),
  mkAnimal("Manta Ray","Ocean","ü™º", {size:7,str:5,spd:7}, "Glide Sweep", 0.95, "Manta rays ‚Äòfly‚Äô through water with wide fins."),
  mkAnimal("Sea Lion","Ocean","ü¶≠", {size:6,str:6,spd:7}, "Whirlpool Spin", 0.98, "Sea lions are great swimmers and can move quickly underwater."),
  mkAnimal("Hammerhead Shark","Ocean","ü¶à", {size:8,str:8,spd:7}, "Side-Sweep Bite", 1.04, "Hammerheads have wide heads that help them sense prey better."),
  mkAnimal("Electric Eel","Ocean","‚ö°üêü", {size:6,str:7,spd:6}, "Zap Burst", 1.03, "Electric eels can generate strong electric shocks."),
  mkAnimal("Octopus","Ocean","üêô", {size:6,str:7,spd:6}, "Tentacle Tangle", 1.00, "Octopuses are known for being clever problem-solvers."),

  // BIRDS
  mkAnimal("Peregrine Falcon","Birds","ü¶Ö", {size:5,str:6,spd:10}, "Sky Dive Strike", 1.10, "Peregrine falcons are famous for extremely fast dives."),
  mkAnimal("Bald Eagle","Birds","ü¶Ö", {size:6,str:7,spd:7}, "Talon Grab", 1.02, "Eagles have powerful talons for grabbing prey."),
  mkAnimal("Owl","Birds","ü¶â", {size:4,str:5,spd:6}, "Silent Swoop", 0.98, "Owls can fly very quietly compared to many other birds."),
  mkAnimal("Hummingbird","Birds","üê¶", {size:2,str:3,spd:10}, "Hover Jab", 0.92, "Hummingbirds can hover in place while feeding."),
  mkAnimal("Cassowary","Birds","ü¶§", {size:7,str:8,spd:7}, "Dino Kick", 1.06, "Cassowaries are big, powerful birds‚Äîoften called ‚Äòdinosaur-like.‚Äô"),
  mkAnimal("Peacock","Birds","ü¶ö", {size:4,str:3,spd:5}, "Fan Flare", 0.88, "Peacocks can fan out colorful tail feathers to impress."),

  // REPTILES
  mkAnimal("Komodo Dragon","Reptiles","ü¶é", {size:7,str:8,spd:6}, "Rending Bite", 1.05, "Komodo dragons are the largest living lizards."),
  mkAnimal("King Cobra","Reptiles","üêç", {size:5,str:8,spd:7}, "Venom Feint", 1.03, "Cobras can spread a hood to look bigger and scary."),
  mkAnimal("Alligator","Reptiles","üêä", {size:8,str:9,spd:6}, "Clamp & Roll", 1.06, "Alligators can do a powerful ‚Äòdeath roll‚Äô in water."),
  mkAnimal("Chameleon","Reptiles","ü¶é", {size:3,str:3,spd:4}, "Tongue Snap", 0.90, "Chameleons can shoot out their tongues super fast to catch insects."),
  mkAnimal("Rattlesnake","Reptiles","üêç", {size:4,str:7,spd:6}, "Rattle Warning Strike", 1.02, "Rattlesnakes can warn with a rattling tail sound."),
  mkAnimal("Anaconda","Reptiles","üêç", {size:8,str:9,spd:5}, "Coil Crush", 1.05, "Big constrictor snakes squeeze to subdue prey."),

  // AMPHIBIANS
  mkAnimal("Poison Dart Frog","Amphibians","üê∏", {size:2,str:4,spd:5}, "Toxic Touch", 0.92, "Some dart frogs have bright colors that warn predators: ‚ÄòDon‚Äôt eat me!‚Äô"),
  mkAnimal("Bullfrog","Amphibians","üê∏", {size:3,str:4,spd:5}, "Splash Lunge", 0.90, "Frogs can use strong back legs to leap."),
  mkAnimal("Salamander","Amphibians","ü¶é", {size:3,str:3,spd:4}, "Slippery Escape", 0.88, "Some salamanders have slippery skin that can help them avoid predators."),

  // INSECTS & ARTHROPODS
  mkAnimal("Praying Mantis","Insects","ü¶ó", {size:2,str:5,spd:7}, "Snap Grab", 0.95, "Praying mantises have lightning-fast grabbing forelegs."),
  mkAnimal("Tarantula","Insects","üï∑Ô∏è", {size:3,str:6,spd:4}, "Hair Flick", 0.95, "Some tarantulas can flick itchy hairs to defend themselves."),
  mkAnimal("Scorpion","Insects","ü¶Ç", {size:2,str:6,spd:5}, "Stinger Jab", 0.96, "Scorpions glow under ultraviolet (UV) light!"),
  mkAnimal("Giant Centipede","Insects","üêõ", {size:3,str:7,spd:7}, "Venom Pinch", 1.00, "Centipedes use venom claws (not jaws) to capture prey."),
];

// Build 4 moves for each animal (1 manual + 3 generated)
const MOVE_POOLS = {
  Land: [
    {name:"Power Charge", power:1.02, fact:"Some land animals can accelerate quickly for a surprise hit."},
    {name:"Grapple Toss", power:1.00, fact:"Strength and balance help in close-range tussles."},
    {name:"Stomp Shock", power:0.98, fact:"Big feet can create a strong impact on the ground."},
    {name:"Feint & Strike", power:1.01, fact:"Trick moves can help land a hit at the right moment."},
  ],
  Ocean: [
    {name:"Current Dash", power:1.02, fact:"Ocean animals can use currents to move efficiently."},
    {name:"Deep Dive", power:0.99, fact:"Some sea animals can dive very deep where it‚Äôs dark and cold."},
    {name:"Tail Whip", power:1.00, fact:"A strong tail is like a powerful motor in water."},
    {name:"Bubble Burst", power:0.97, fact:"Air bubbles can confuse enemies underwater for a moment."},
  ],
  Birds: [
    {name:"Wing Gust", power:0.98, fact:"Bird wings can create strong gusts of air when flapping hard."},
    {name:"Talon Slash", power:1.02, fact:"Many birds of prey use talons to grip tightly."},
    {name:"Sky Fakeout", power:1.00, fact:"Quick direction changes help birds dodge in mid-air."},
    {name:"Beak Jab", power:0.97, fact:"Beaks are handy tools for pecking and grabbing."},
  ],
  Reptiles: [
    {name:"Scale Shield", power:0.95, fact:"Reptile scales help protect their bodies."},
    {name:"Ambush Snap", power:1.02, fact:"Some reptiles wait still‚Ä¶ then strike fast."},
    {name:"Tail Lash", power:0.99, fact:"Some reptiles use tails for balance‚Äîor defense."},
    {name:"Heat Burst", power:0.97, fact:"Reptiles often rely on warmth to get moving quickly."},
  ],
  Amphibians: [
    {name:"Sticky Leap", power:0.99, fact:"Some amphibians have sticky skin or toes for gripping."},
    {name:"Splash Screen", power:0.95, fact:"A quick splash can distract an opponent."},
    {name:"Quick Dart", power:1.01, fact:"Small amphibians can move in sudden bursts."},
    {name:"Camouflage Chill", power:0.97, fact:"Blending in can help avoid being targeted."},
  ],
  Insects: [
    {name:"Rapid Skitter", power:1.00, fact:"Many insects can sprint in tiny, speedy bursts."},
    {name:"Armor Plate", power:0.95, fact:"Hard exoskeletons act like natural armor."},
    {name:"Pinch Strike", power:1.02, fact:"Some arthropods use strong pincers for gripping."},
    {name:"Startle Buzz", power:0.97, fact:"Sudden sounds or vibrations can surprise predators."},
  ],
};

// default pool if category not found
const DEFAULT_POOL = [
  {name:"Wild Combo", power:1.00, fact:"Different animals have different tricks to survive!"},
  {name:"Dodge & Counter", power:1.00, fact:"Being quick helps avoid hits and strike back."},
  {name:"Brave Push", power:0.98, fact:"Courage (and timing!) can change a battle."},
  {name:"Big Impact", power:1.02, fact:"Mass and momentum can make hits feel stronger."},
];

for(const a of ANIMALS){
  const pool = MOVE_POOLS[a.category] || DEFAULT_POOL;
  // Create 4 moves: primary + 3 from pool (shuffled)
  const picks = shuffle([...pool]).slice(0,3);
  a.moves = [
    { name: a.primaryMoveName, power: a.primaryMovePower, fact: a.primaryMoveFact, isPrimary:true },
    ...picks
  ];
}

/* =========================================
   UI + Game state
   ========================================= */
let stage = "select"; // select | battle | quiz
let picking = 1; // 1 then 2

let p1 = null, p2 = null;
let p1HP = 100, p2HP = 100;

let battleStarted = false;
let currentTurn = 1; // 1 or 2
let inputLocked = false; // while pop fact showing

let shownFacts = []; // {attackerId, moveName, fact, correctAnswerString}
let quizState = { questions: [], answers: new Map(), score: 0, locked: false };

const el = (id)=>document.getElementById(id);

const selectionView = el("selectionView");
const battleView = el("battleView");
const quizView = el("quizView");

const stageTitle = el("stageTitle");
const stageDesc = el("stageDesc");
const pickHint = el("pickHint");
const animalGrid = el("animalGrid");
const categorySelect = el("categorySelect");
const searchInput = el("searchInput");

const startBattleBtn = el("startBattleBtn");
const resetBtn = el("resetBtn");
const randomBtn = el("randomBtn");
const homeBtn = el("homeBtn");
const quizHomeBtn = el("quizHomeBtn");

const fighter1 = el("fighter1");
const fighter2 = el("fighter2");
const battleLog = el("battleLog");
const turnHint = el("turnHint");

const p1Moves = el("p1Moves");
const p2Moves = el("p2Moves");
const p1TurnTag = el("p1TurnTag");
const p2TurnTag = el("p2TurnTag");

const popFact = el("popFact");
const popTitle = el("popTitle");
const popBody = el("popBody");

const quizWrap = el("quizWrap");
const quizScoreHint = el("quizScoreHint");
const picksSummary = el("picksSummary");
const toast = el("toast");

/* =========================================
   Init
   ========================================= */
initCategoryOptions();
renderGrid();
syncRightPanel();
syncStageUI();

categorySelect.addEventListener("change", renderGrid);
searchInput.addEventListener("input", renderGrid);

randomBtn.addEventListener("click", ()=>{
  const pool = filteredAnimals();
  if(!pool.length) return showToast("No animals match that filter.");
  const pick = pool[Math.floor(Math.random()*pool.length)];
  if(picking===1 && p2 && pick.id===p2.id) return showToast("Try again ‚Äî Player 2 already picked that one.");
  if(picking===2 && p1 && pick.id===p1.id) return showToast("Try again ‚Äî Player 1 already picked that one.");
  chooseAnimal(pick);
});

resetBtn.addEventListener("click", resetAll);

startBattleBtn.addEventListener("click", ()=>{
  if(!p1 || !p2) return;
  if(battleStarted) return;
  battleStarted = true;
  currentTurn = 1;
  turnHint.textContent = "Battle started! Player 1, choose a move!";
  startBattleBtn.disabled = true;
  logEntry(`<b>Battle begins!</b><div class="meta">Player 1 goes first. Click a move button to attack!</div>`);
  updateTurnUI();
});

homeBtn.addEventListener("click", ()=>{
  goHome();
});
quizHomeBtn.addEventListener("click", ()=>{
  goHome();
});

/* =========================================
   Selection
   ========================================= */
function initCategoryOptions(){
  const cats = Array.from(new Set(ANIMALS.map(a=>a.category))).sort();
  for(const c of cats){
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    categorySelect.appendChild(opt);
  }
}
function filteredAnimals(){
  const cat = categorySelect.value;
  const q = (searchInput.value||"").trim().toLowerCase();
  return ANIMALS.filter(a=>{
    const okCat = (cat==="All") || (a.category===cat);
    const okQ = !q || a.name.toLowerCase().includes(q) || a.category.toLowerCase().includes(q);
    return okCat && okQ;
  });
}

function renderGrid(){
  const list = filteredAnimals();
  animalGrid.innerHTML = "";
  for(const a of list){
    const card = document.createElement("div");
    card.className = "animalCard";
    if(p1 && a.id===p1.id) card.classList.add("selectedP1");
    if(p2 && a.id===p2.id) card.classList.add("selectedP2");
    card.innerHTML = `
      <div class="animalTop">
        <div class="emoji">${escapeHtml(a.emoji)}</div>
        <div class="tag">${escapeHtml(a.category)}</div>
      </div>
      <p class="animalName">${escapeHtml(a.name)}</p>
      <p class="move">Signature: <b>${escapeHtml(a.primaryMoveName)}</b></p>
      <div class="stats">
        <div class="stat"><b>${a.stats.size}</b><span>Size</span></div>
        <div class="stat"><b>${a.stats.str}</b><span>Strength</span></div>
        <div class="stat"><b>${a.stats.spd}</b><span>Speed</span></div>
      </div>
    `;
    card.addEventListener("click", ()=> chooseAnimal(a));
    animalGrid.appendChild(card);
  }
}

function chooseAnimal(animal){
  if(stage!=="select") return;

  if(picking===1){
    if(p2 && animal.id===p2.id) return showToast("Player 2 already picked that one!");
    p1 = animal;
    picking = 2;
    showToast(`Player 1 picked ${animal.name}!`);
  } else {
    if(p1 && animal.id===p1.id) return showToast("Player 1 already picked that one!");
    p2 = animal;
    showToast(`Player 2 picked ${animal.name}!`);
  }
  renderGrid();
  syncRightPanel();
  syncStageUI();

  if(p1 && p2){
    stage = "battle";
    syncStageUI();
    buildBattleUI();
    showToast("Ready! Press Start Battle, then pick moves.");
  }
}

function syncRightPanel(){
  picksSummary.innerHTML =
    `Player 1: <b>${p1 ? escapeHtml(p1.name) : "‚Äî"}</b><br/>` +
    `Player 2: <b>${p2 ? escapeHtml(p2.name) : "‚Äî"}</b>`;
}

function syncStageUI(){
  selectionView.style.display = (stage==="select") ? "" : "none";
  battleView.style.display = (stage==="battle") ? "" : "none";
  quizView.style.display = (stage==="quiz") ? "" : "none";

  homeBtn.style.display = "none";
  quizHomeBtn.disabled = true;

  if(stage==="select"){
    stageTitle.textContent = "Stage 1: Choose animals";
    stageDesc.textContent = "Player 1 picks first, then Player 2. Every animal has 4 moves in battle.";
    pickHint.innerHTML = `Now picking: <b>Player ${picking}</b>`;
  }
  if(stage==="battle"){
    stageTitle.textContent = "Stage 2: Battle (YOU control the moves)";
    stageDesc.textContent = "Take turns pressing move buttons. A fun fact pops up for 2‚Äì3 seconds each move.";
  }
  if(stage==="quiz"){
    stageTitle.textContent = "Stage 3: Quiz time!";
    stageDesc.textContent = "Answer 4 questions based on the fun facts you just saw.";
  }
}

/* =========================================
   Battle
   ========================================= */
function buildBattleUI(){
  p1HP = 100; p2HP = 100;
  battleStarted = false;
  currentTurn = 1;
  inputLocked = false;
  shownFacts = [];
  battleLog.innerHTML = "";
  turnHint.textContent = "Press Start Battle‚Ä¶";

  startBattleBtn.disabled = false;

  fighter1.innerHTML = fighterTemplate(p1, p1HP, "p1");
  fighter2.innerHTML = fighterTemplate(p2, p2HP, "p2");

  renderMoveButtons();
  updateTurnUI();
}

function renderMoveButtons(){
  p1Moves.innerHTML = "";
  p2Moves.innerHTML = "";

  p1.moves.forEach((m, idx)=>{
    const b = document.createElement("button");
    b.className = "btn small";
    b.textContent = m.name;
    b.addEventListener("click", ()=> onMoveClick(1, idx));
    p1Moves.appendChild(b);
  });

  p2.moves.forEach((m, idx)=>{
    const b = document.createElement("button");
    b.className = "btn small";
    b.textContent = m.name;
    b.addEventListener("click", ()=> onMoveClick(2, idx));
    p2Moves.appendChild(b);
  });
}

function updateTurnUI(){
  const p1Active = battleStarted && currentTurn===1 && !inputLocked;
  const p2Active = battleStarted && currentTurn===2 && !inputLocked;

  p1TurnTag.textContent = p1Active ? "Your turn!" : (battleStarted ? "Wait‚Ä¶" : "Waiting‚Ä¶");
  p2TurnTag.textContent = p2Active ? "Your turn!" : (battleStarted ? "Wait‚Ä¶" : "Waiting‚Ä¶");

  Array.from(p1Moves.querySelectorAll("button")).forEach(btn=> btn.disabled = !p1Active);
  Array.from(p2Moves.querySelectorAll("button")).forEach(btn=> btn.disabled = !p2Active);
}

function fighterTemplate(a, hp, side){
  const hpPct = Math.max(0, Math.min(100, hp));
  return `
    <div class="fighterTop">
      <div class="fighterName">
        <div class="emoji">${escapeHtml(a.emoji)}</div>
        <div>
          <div>${escapeHtml(a.name)}</div>
          <div class="mini">${escapeHtml(a.category)} ‚Ä¢ 4 moves</div>
        </div>
      </div>
      <div class="tag">${side==="p1" ? "Player 1" : "Player 2"}</div>
    </div>
    <div>
      <div class="hpbar"><div class="hpfill" style="width:${hpPct}%"></div></div>
      <div class="hptext"><span>HP</span><span><b>${Math.round(hpPct)}</b>/100</span></div>
    </div>
    <div class="stats">
      <div class="stat"><b>${a.stats.size}</b><span>Size</span></div>
      <div class="stat"><b>${a.stats.str}</b><span>Strength</span></div>
      <div class="stat"><b>${a.stats.spd}</b><span>Speed</span></div>
    </div>
  `;
}

function updateFighterUI(){
  fighter1.innerHTML = fighterTemplate(p1, p1HP, "p1");
  fighter2.innerHTML = fighterTemplate(p2, p2HP, "p2");
}

function logEntry(html){
  const div = document.createElement("div");
  div.className = "entry";
  div.innerHTML = html;
  battleLog.prepend(div);
}

function computeDamage(att, def, movePower){
  const A = att.stats;
  const D = def.stats;

  const base = (A.str*0.52 + A.spd*0.32 + A.size*0.16) * 7;

  const matchup =
    (A.spd / Math.max(1, D.spd)) * 0.35 +
    (A.str / Math.max(1, D.str)) * 0.45 +
    (A.size / Math.max(1, D.size)) * 0.20;

  const rng = 0.90 + Math.random()*0.24; // 0.90..1.14
  let dmg = base * matchup * movePower * rng;

  dmg = Math.max(6, Math.min(30, dmg));
  return Math.round(dmg);
}

async function onMoveClick(player, moveIndex){
  if(!battleStarted) return showToast("Press Start Battle first!");
  if(inputLocked) return;

  if(player !== currentTurn) return;

  const attacker = (player===1) ? p1 : p2;
  const defender = (player===1) ? p2 : p1;
  const move = attacker.moves[moveIndex];

  inputLocked = true;
  updateTurnUI();

  const dmg = computeDamage(attacker, defender, move.power);

  if(player===1) p2HP = Math.max(0, p2HP - dmg);
  else p1HP = Math.max(0, p1HP - dmg);

  updateFighterUI();

  // hit animation
  const hitEl = (player===1) ? fighter2 : fighter1;
  hitEl.classList.add("hit");
  setTimeout(()=>hitEl.classList.remove("hit"), 380);

  // log
  logEntry(`
    <b>${escapeHtml(attacker.name)}</b> used <b>${escapeHtml(move.name)}</b> and dealt <b>${dmg}</b> damage!
    <div class="meta">‚ú® Fun fact: ${escapeHtml(move.fact)}</div>
  `);

  // store for quiz creation
  shownFacts.push({
    animal: attacker.name,
    moveName: move.name,
    fact: move.fact
  });

  // pop-up fact (2.6s)
  showPopFact(`${attacker.name} ‚Äî ${move.name}`, move.fact, 2600);

  // wait for readability
  await sleep(2600);

  // check win
  if(p1HP<=0 || p2HP<=0){
    endBattle();
    return;
  }

  // next turn
  currentTurn = (currentTurn===1) ? 2 : 1;
  turnHint.textContent = `Player ${currentTurn}, choose a move!`;
  inputLocked = false;
  updateTurnUI();
}

function showPopFact(title, fact, ms){
  popTitle.textContent = title;
  popBody.textContent = fact;
  popFact.classList.add("show");
  clearTimeout(showPopFact._t);
  showPopFact._t = setTimeout(()=> popFact.classList.remove("show"), ms);
}

function endBattle(){
  inputLocked = true;
  updateTurnUI();

  const winner = (p1HP>p2HP) ? {player:1, animal:p1} : {player:2, animal:p2};
  const loser  = (winner.player===1) ? {player:2, animal:p2} : {player:1, animal:p1};

  turnHint.textContent = `Winner: Player ${winner.player}!`;
  logEntry(`<b>üèÜ Winner: Player ${winner.player} ‚Äî ${escapeHtml(winner.animal.name)}!</b>
            <div class="meta">${escapeHtml(loser.animal.name)} has run out of HP.</div>`);

  homeBtn.style.display = ""; // allow going home after quiz too
  showToast(`Winner: ${winner.animal.name}! Quiz time‚Ä¶`);

  // go to quiz shortly
  setTimeout(()=>{
    stage = "quiz";
    syncStageUI();
    buildQuiz();
  }, 700);
}

/* =========================================
   Quiz (built from facts shown)
   - 4 questions
   - Each question: "Which fun fact was shown for [animal ‚Äî move]?"
   ========================================= */
function buildQuiz(){
  quizState = { questions: [], answers: new Map(), score: 0, locked: false };
  quizWrap.innerHTML = "";
  quizScoreHint.textContent = "Score: 0 / 4";
  quizHomeBtn.disabled = true;

  // Need a pool of at least 4 facts
  let factPool = uniqueFacts(shownFacts);

  // If players used fewer than 4 moves total, pad with some other move facts from chosen animals
  if(factPool.length < 4){
    const extra = [
      ...p1.moves.map(m=>({animal:p1.name, moveName:m.name, fact:m.fact})),
      ...p2.moves.map(m=>({animal:p2.name, moveName:m.name, fact:m.fact})),
    ];
    factPool = uniqueFacts([...factPool, ...extra]);
  }

  // Still small? Pad from global moves
  if(factPool.length < 4){
    for(const a of ANIMALS){
      for(const m of a.moves){
        factPool.push({animal:a.name, moveName:m.name, fact:m.fact});
        if(factPool.length>=12) break;
      }
      if(factPool.length>=12) break;
    }
    factPool = uniqueFacts(factPool);
  }

  shuffle(factPool);
  const chosen = factPool.slice(0,4);

  // Build 4 questions: pick 1 correct fact + 3 decoys
  for(let i=0;i<chosen.length;i++){
    const correct = chosen[i];

    const decoys = shuffle(factPool.filter(x=>x.fact!==correct.fact)).slice(0,3);
    const options = shuffle([correct.fact, ...decoys.map(d=>d.fact)]);

    quizState.questions.push({
      prompt: `Which fun fact did you just see for: ${correct.animal} ‚Äî ${correct.moveName}?`,
      options,
      answer: correct.fact
    });
  }

  quizState.questions.forEach((q, idx)=>{
    const qEl = document.createElement("div");
    qEl.className = "quizQ";
    qEl.innerHTML = `
      <h3>Q${idx+1}. ${escapeHtml(q.prompt)}</h3>
      <div class="options" id="qopts-${idx}"></div>
    `;
    quizWrap.appendChild(qEl);

    const opts = qEl.querySelector(`#qopts-${idx}`);
    q.options.forEach((choice)=>{
      const o = document.createElement("div");
      o.className = "opt";
      o.textContent = choice;
      o.addEventListener("click", ()=> answerQuestion(idx, choice, o, opts));
      opts.appendChild(o);
    });
  });
}

function answerQuestion(qIndex, choice, optEl, optsWrap){
  if(quizState.locked) return;
  if(quizState.answers.has(qIndex)) return;

  const q = quizState.questions[qIndex];
  const correct = (choice === q.answer);

  quizState.answers.set(qIndex, choice);

  const children = Array.from(optsWrap.children);
  children.forEach((node)=>{
    const isCorrect = node.textContent === q.answer;
    const isPicked = node === optEl;
    if(isCorrect) node.classList.add("correct");
    if(isPicked && !correct) node.classList.add("wrong");
    node.style.pointerEvents = "none";
  });

  if(correct) quizState.score++;
  quizScoreHint.textContent = `Score: ${quizState.score} / 4`;

  if(quizState.answers.size === 4){
    quizState.locked = true;
    const msg = (quizState.score === 4) ? "Perfect score! üß†‚ú®"
              : (quizState.score >= 3) ? "Awesome! üåü"
              : (quizState.score >= 2) ? "Nice work! üëç"
              : "Good try! üôÇ";
    showToast(msg);

    const sum = document.createElement("div");
    sum.className = "hint";
    sum.style.marginTop = "10px";
    sum.innerHTML = `<b>Final quiz score:</b> ${quizState.score} / 4`;
    quizWrap.appendChild(sum);

    // enable home
    quizHomeBtn.disabled = false;
  }
}

/* =========================================
   Home / Reset
   ========================================= */
function goHome(){
  // back to selection with fresh picks
  stage = "select";
  picking = 1;
  p1 = null; p2 = null;
  p1HP = 100; p2HP = 100;
  battleStarted = false;
  currentTurn = 1;
  inputLocked = false;
  shownFacts = [];
  quizState = { questions: [], answers: new Map(), score: 0, locked: false };

  searchInput.value = "";
  categorySelect.value = "All";
  renderGrid();
  syncRightPanel();
  syncStageUI();
  showToast("Back to Home! Pick new animals.");
}

function resetAll(){
  goHome();
}

/* =========================================
   Helpers
   ========================================= */
function mkAnimal(name, category, emoji, stats, primaryMoveName, primaryMovePower, primaryMoveFact){
  return {
    id: slug(name),
    name, category, emoji,
    stats,
    primaryMoveName, primaryMovePower, primaryMoveFact,
    moves: []
  };
}
function slug(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""); }

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 1600);
}
function sleep(ms){ return new Promise(res=>setTimeout(res, ms)); }
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function uniqueFacts(list){
  const seen = new Set();
  const out = [];
  for(const x of list){
    const k = x.animal + "|" + x.moveName + "|" + x.fact;
    if(seen.has(k)) continue;
    seen.add(k);
    out.push(x);
  }
  return out;
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>
