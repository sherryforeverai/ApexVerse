<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Who Would Win? ‚Äî Animal Battle + Quiz</title>
  <style>
    :root{
      --bg:#0b0f19;
      --panel:#101a2b;
      --panel2:#0e1524;
      --text:#eaf1ff;
      --muted:#a9b7d1;
      --accent:#7cf7c2;
      --accent2:#7cc7ff;
      --danger:#ff6b81;
      --warn:#ffcc66;
      --good:#7cf7c2;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius:18px;
      --border: 1px solid rgba(255,255,255,.08);
      --glow: 0 0 0 2px rgba(124,247,194,.10), 0 0 25px rgba(124,247,194,.08);
      --glow2: 0 0 0 2px rgba(124,199,255,.10), 0 0 25px rgba(124,199,255,.08);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--font);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(124,199,255,.18), transparent 65%),
        radial-gradient(900px 600px at 80% 20%, rgba(124,247,194,.14), transparent 60%),
        radial-gradient(700px 500px at 60% 90%, rgba(255,204,102,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{
      padding:18px 16px 10px;
      max-width:1100px;
      margin:0 auto;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(124,247,194,.95), rgba(124,199,255,.95));
      display:grid;place-items:center;
      color:#07111f;
      box-shadow: var(--shadow);
      font-weight:900;
    }
    h1{
      margin:0;
      font-size:18px;
      line-height:1.15;
    }
    .sub{
      margin:2px 0 0;
      color:var(--muted);
      font-size:12px;
    }
    .pillbar{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border: var(--border);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      user-select:none;
    }
    main{
      max-width:1100px;
      margin:0 auto;
      padding: 10px 16px 60px;
      display:grid;
      gap:14px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      header{flex-direction:column; align-items:flex-start}
      .pillbar{justify-content:flex-start}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: rgba(16,26,43,.35);
    }
    .card .hd h2{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .card .hd p{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }
    .card .bd{ padding:14px; }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom:12px;
    }
    .leftControls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .rightControls{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .select, .search{
      border-radius: 12px;
      border: var(--border);
      background: rgba(14,21,36,.55);
      color: var(--text);
      padding:10px 12px;
      outline:none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .search{min-width:240px}
    @media (max-width:520px){ .search{min-width:0; width:100%} }

    .btn{
      border-radius: 14px;
      border: var(--border);
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      color: var(--text);
      background: rgba(255,255,255,.06);
      transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10) }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background: linear-gradient(135deg, rgba(124,247,194,.95), rgba(124,199,255,.95)); color:#07111f; border:0; }
    .btn.primary:hover{ filter: brightness(1.05) }
    .btn.danger{ background: rgba(255,107,129,.12); border-color: rgba(255,107,129,.25) }
    .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none }

    .hint{
      font-size:12px;
      color: var(--muted);
    }

    .animalGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){ .animalGrid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 720px){ .animalGrid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 420px){ .animalGrid{ grid-template-columns: 1fr; } }

    .animalCard{
      border-radius: 18px;
      border: var(--border);
      background:
        radial-gradient(160px 90px at 20% 10%, rgba(124,247,194,.20), transparent 70%),
        radial-gradient(160px 90px at 80% 10%, rgba(124,199,255,.18), transparent 70%),
        rgba(14,21,36,.55);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      padding:12px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .2s ease, filter .2s ease;
      position:relative;
      overflow:hidden;
    }
    .animalCard:hover{ transform: translateY(-2px); filter: brightness(1.05) }
    .animalCard.selectedP1{ box-shadow: var(--shadow), var(--glow); border-color: rgba(124,247,194,.35) }
    .animalCard.selectedP2{ box-shadow: var(--shadow), var(--glow2); border-color: rgba(124,199,255,.35) }
    .animalTop{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      margin-bottom:10px;
    }
    .emoji{
      font-size:34px;
      line-height:1;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));
    }
    .tag{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border: var(--border);
      color: var(--muted);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .animalName{
      font-weight:900;
      font-size:13px;
      margin:0 0 4px;
    }
    .move{
      margin:0;
      font-size:12px;
      color: var(--muted);
    }
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
      margin-top:10px;
    }
    .stat{
      border-radius: 12px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:8px;
      text-align:center;
    }
    .stat b{ display:block; font-size:12px }
    .stat span{ font-size:10px; color:var(--muted) }

    /* Battle panel */
    .battleWrap{
      display:grid;
      gap:12px;
    }
    .arena{
      border-radius: 20px;
      border: var(--border);
      background:
        radial-gradient(600px 220px at 50% 0%, rgba(124,199,255,.12), transparent 60%),
        radial-gradient(600px 220px at 50% 100%, rgba(124,247,194,.10), transparent 60%),
        rgba(14,21,36,.45);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .arenaRow{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:10px;
      align-items:center;
    }
    .fighter{
      border-radius: 18px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:12px;
      display:grid;
      gap:10px;
      min-height:122px;
      position:relative;
      overflow:hidden;
    }
    .fighter.p1{ box-shadow: inset 0 0 0 2px rgba(124,247,194,.08); }
    .fighter.p2{ box-shadow: inset 0 0 0 2px rgba(124,199,255,.08); }
    .fighterTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .fighterName{
      display:flex; align-items:center; gap:10px;
      font-weight:900;
    }
    .fighterName .emoji{ font-size:40px }
    .mini{
      font-size:11px;
      color:var(--muted);
      font-weight:600;
    }
    .hpbar{
      height:14px;
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      border: var(--border);
      overflow:hidden;
      position:relative;
    }
    .hpfill{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, rgba(124,247,194,.95), rgba(124,199,255,.85));
      transition: width .35s ease;
    }
    .hptext{
      display:flex; justify-content:space-between; font-size:11px; color:var(--muted);
    }
    .vs{
      font-weight:1000;
      letter-spacing:.5px;
      color: rgba(255,255,255,.75);
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      border-radius: 999px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .log{
      border-radius: 18px;
      border: var(--border);
      background: rgba(0,0,0,.18);
      padding:12px;
      height: 210px;
      overflow:auto;
      font-size:12px;
      line-height:1.35;
    }
    .log .entry{
      padding:10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      margin-bottom:10px;
    }
    .log .entry b{ color: var(--text) }
    .log .meta{ color: var(--muted); margin-top:6px; }
    .hit{
      animation: hit .35s ease;
    }
    @keyframes hit{
      0%{ transform: translateX(0) }
      30%{ transform: translateX(-6px) rotate(-.4deg) }
      60%{ transform: translateX(6px) rotate(.4deg) }
      100%{ transform: translateX(0) }
    }

    /* Quiz */
    .quizQ{
      border-radius: 18px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:12px;
      margin-bottom:12px;
    }
    .quizQ h3{
      margin:0 0 10px;
      font-size:13px;
    }
    .options{
      display:grid;
      gap:8px;
    }
    .opt{
      border-radius: 14px;
      border: var(--border);
      background: rgba(255,255,255,.03);
      padding:10px;
      cursor:pointer;
      font-size:12px;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .opt:hover{ background: rgba(255,255,255,.06) }
    .opt:active{ transform: translateY(1px) }
    .opt.correct{ border-color: rgba(124,247,194,.45); background: rgba(124,247,194,.10) }
    .opt.wrong{ border-color: rgba(255,107,129,.45); background: rgba(255,107,129,.10) }
    .quizFooter{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top:8px;
    }

    .toast{
      position: fixed;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16,26,43,.92);
      border: var(--border);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 12px;
      display:none;
      z-index: 999;
    }
    .toast.show{ display:block; animation: pop .18s ease }
    @keyframes pop{ from{ transform: translateX(-50%) scale(.96); opacity:.0 } to{ transform: translateX(-50%) scale(1); opacity:1 } }
    footer{
      max-width:1100px;
      margin:0 auto;
      padding: 0 16px 22px;
      color: var(--muted);
      font-size: 11px;
    }
    .tinyNote{
      opacity:.85;
      line-height:1.45;
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">WW</div>
    <div>
      <h1>Who Would Win? <span style="color:rgba(255,255,255,.6);font-weight:800">Animal Battle + Quiz</span></h1>
      <div class="sub">Pick two animals ‚Üí watch their signature moves ‚Üí answer a quick quiz ‚Üí play again!</div>
    </div>
  </div>
  <div class="pillbar">
    <div class="pill">üëßüßí Kids-friendly UI</div>
    <div class="pill">ü¶Å 35 animals</div>
    <div class="pill">‚öîÔ∏è Auto battle</div>
    <div class="pill">üß† 4-question quiz</div>
  </div>
</header>

<main class="grid">
  <!-- LEFT: Selection / Battle / Quiz -->
  <section class="card">
    <div class="hd">
      <div>
        <h2 id="stageTitle">Stage 1: Choose animals</h2>
        <p id="stageDesc">Player 1 picks first, then Player 2. Use the filters to find animals quickly.</p>
      </div>
      <div style="display:flex;gap:10px;align-items:center">
        <button id="resetBtn" class="btn danger">Restart</button>
      </div>
    </div>
    <div class="bd">
      <!-- Selection -->
      <div id="selectionView">
        <div class="controls">
          <div class="leftControls">
            <select id="categorySelect" class="select">
              <option value="All">All categories</option>
            </select>
            <input id="searchInput" class="search" placeholder="Search animals‚Ä¶ (e.g., tiger, shark, falcon)" />
          </div>
          <div class="rightControls">
            <span class="hint" id="pickHint">Now picking: <b>Player 1</b></span>
            <button id="randomBtn" class="btn">üé≤ Random pick</button>
          </div>
        </div>

        <div class="animalGrid" id="animalGrid"></div>
      </div>

      <!-- Battle -->
      <div id="battleView" style="display:none">
        <div class="battleWrap">
          <div class="arena">
            <div class="arenaRow">
              <div class="fighter p1" id="fighter1"></div>
              <div class="vs">VS</div>
              <div class="fighter p2" id="fighter2"></div>
            </div>
          </div>

          <div class="controls">
            <div class="leftControls">
              <button id="startBattleBtn" class="btn primary">Start Battle!</button>
              <button id="skipBtn" class="btn" disabled>‚è© Skip animation</button>
            </div>
            <div class="rightControls">
              <span class="hint" id="turnHint">Ready‚Ä¶</span>
            </div>
          </div>

          <div class="log" id="battleLog" aria-live="polite"></div>
        </div>
      </div>

      <!-- Quiz -->
      <div id="quizView" style="display:none">
        <div id="quizWrap"></div>
        <div class="quizFooter">
          <div class="hint" id="quizScoreHint">Score: 0 / 4</div>
          <button id="playAgainBtn" class="btn primary">Play again</button>
        </div>
      </div>
    </div>
  </section>

  <!-- RIGHT: Info / status -->
  <aside class="card">
    <div class="hd">
      <div>
        <h2>How it works</h2>
        <p>Each animal has stats and a signature move. Damage is based on both animals‚Äô stats.</p>
      </div>
    </div>
    <div class="bd">
      <div class="card" style="background:rgba(255,255,255,.02); box-shadow:none; border:var(--border)">
        <div class="bd" style="display:grid;gap:10px">
          <div class="hint">
            <b>Damage idea (simple + fun):</b><br/>
            Move power √ó (Strength + Speed + Size) with a matchup bonus vs opponent stats.
          </div>
          <div class="hint">
            <b>Quiz:</b> The questions come from the fun facts shown during the battle you just watched.
          </div>
          <div class="hint">
            <b>Tip:</b> Want more animals? Scroll to the bottom of the code and copy an existing animal entry.
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="background:rgba(255,255,255,.02); box-shadow:none; border:var(--border)">
        <div class="bd" style="display:grid;gap:10px">
          <div class="hint"><b>Players:</b></div>
          <div class="hint" id="picksSummary">Player 1: ‚Äî<br/>Player 2: ‚Äî</div>
        </div>
      </div>
    </div>
  </aside>
</main>

<div class="toast" id="toast"></div>

<footer>
  <div class="tinyNote">
    Note: Fun facts here are designed to be kid-friendly and ‚Äúclose enough‚Äù for gameplay. If you want all facts to be strictly verified,
    you can swap the fact strings anytime.
  </div>
</footer>

<script>
/* ============================
   DATA: 35 animals (editable)
   Stats are 1..10
   ============================ */
const ANIMALS = [
  // LAND
  mkAnimal("Tiger","Land","üêØ", {size:7,str:9,spd:7}, "Pounce & Bite", 1.10,
    "Tigers can leap forward several meters when they pounce!",
    mkQuiz("Tiger time! What move did the Tiger use?", ["Whirlpool Spin","Pounce & Bite","Shell Smash","Ink Cloud"], 1)
  ),
  mkAnimal("Lion","Land","ü¶Å", {size:8,str:9,spd:6}, "Roaring Rush", 1.05,
    "A lion‚Äôs roar can be heard from several kilometers away.",
    mkQuiz("Lion fact: What‚Äôs special about a lion‚Äôs roar?", ["It changes color","It can be heard from far away","It freezes water","It makes light"], 1)
  ),
  mkAnimal("Elephant","Land","üêò", {size:10,str:10,spd:4}, "Trunk Slam", 1.00,
    "Elephants use their trunks like a super-tool for smelling, grabbing, and spraying water.",
    mkQuiz("Elephant: What is its trunk like?", ["A super-tool","A second tail","A tiny horn","A wing"], 0)
  ),
  mkAnimal("Cheetah","Land","üêÜ", {size:6,str:6,spd:10}, "Lightning Sprint", 1.05,
    "Cheetahs are famous for super-fast sprints (in short bursts).",
    mkQuiz("Cheetah: What is it best known for?", ["Climbing trees","Short super-fast sprints","Living underwater","Flying"], 1)
  ),
  mkAnimal("Gorilla","Land","ü¶ç", {size:8,str:10,spd:5}, "Chest-Beat Crush", 1.05,
    "Gorillas can communicate with sounds, gestures, and facial expressions.",
    mkQuiz("Gorilla: How do they communicate?", ["Only dancing","Sounds + gestures + faces","Telepathy","Morse code"], 1)
  ),
  mkAnimal("Gray Wolf","Land","üê∫", {size:6,str:7,spd:7}, "Pack Tactics", 1.00,
    "Wolves are social and often work together as a pack.",
    mkQuiz("Wolf: What helps wolves hunt?", ["Pack teamwork","Magic","Spikes","Bubbles"], 0)
  ),
  mkAnimal("Brown Bear","Land","üêª", {size:9,str:9,spd:5}, "Bear Hug Bash", 1.00,
    "Bears can have an excellent sense of smell.",
    mkQuiz("Bear: What sense can be super strong?", ["Taste","Smell","X-ray vision","Hearing music"], 1)
  ),
  mkAnimal("Moose","Land","ü´é", {size:9,str:8,spd:5}, "Antler Charge", 0.98,
    "Moose can be surprisingly quick for their size.",
    mkQuiz("Moose: Are they slow or can they be quick?", ["Always slow","Can be quick for their size","Only hop","Only roll"], 1)
  ),
  mkAnimal("Kangaroo","Land","ü¶ò", {size:6,str:7,spd:8}, "Boomer Kick", 1.02,
    "Kangaroos use powerful hind legs for hopping and kicking.",
    mkQuiz("Kangaroo: Which legs are super powerful?", ["Front legs","Hind legs","Ears","Tail"], 1)
  ),
  mkAnimal("Rhino","Land","ü¶è", {size:9,str:9,spd:6}, "Horn Rush", 1.00,
    "Rhino skin can look armor-like, but it‚Äôs still sensitive.",
    mkQuiz("Rhino: How can its skin look?", ["Like armor","Like glass","Like feathers","Like slime"], 0)
  ),

  // OCEAN
  mkAnimal("Great White Shark","Ocean","ü¶à", {size:9,str:9,spd:7}, "Power Bite", 1.08,
    "Sharks have rows of teeth and can replace lost teeth over time.",
    mkQuiz("Shark: What‚Äôs cool about their teeth?", ["They glow","They can be replaced","They‚Äôre made of metal","They shoot lasers"], 1)
  ),
  mkAnimal("Orca","Ocean","üêã", {size:9,str:9,spd:7}, "Wave Ram", 1.06,
    "Orcas are actually dolphins (the biggest kind).",
    mkQuiz("Orca: What group is it in?", ["Biggest dolphin","A giant fish","A crab","A sea turtle"], 0)
  ),
  mkAnimal("Giant Squid","Ocean","ü¶ë", {size:8,str:8,spd:6}, "Ink Cloud", 1.03,
    "Many squids can release ink to confuse predators.",
    mkQuiz("Squid: What can it release?", ["Glitter","Ink","Sand","Fire"], 1)
  ),
  mkAnimal("Crocodile Fish","Ocean","üêü", {size:5,str:6,spd:5}, "Ambush Snap", 0.95,
    "Some fish rely on camouflage and ambush rather than speed.",
    mkQuiz("Ambush hunters: What do they rely on?", ["Camouflage","Only jokes","Rainbows","Mirrors"], 0)
  ),
  mkAnimal("Sea Turtle","Ocean","üê¢", {size:6,str:5,spd:5}, "Shell Smash", 0.92,
    "Sea turtles travel long distances between feeding areas and nesting beaches.",
    mkQuiz("Sea Turtle: What do they do well?", ["Long-distance travel","Climb mountains","Breathe fire","Dig tunnels"], 0)
  ),
  mkAnimal("Dolphin","Ocean","üê¨", {size:6,str:6,spd:8}, "Echo Dash", 1.00,
    "Dolphins use echolocation‚Äîsound‚Äîto help navigate and find food.",
    mkQuiz("Dolphin: What do they use to ‚Äòsee‚Äô in water?", ["Echolocation sound","Flashlights","Paint","Maps"], 0)
  ),
  mkAnimal("Manta Ray","Ocean","ü™º", {size:7,str:5,spd:7}, "Glide Sweep", 0.95,
    "Manta rays ‚Äòfly‚Äô through water with wide fins.",
    mkQuiz("Manta ray: How does it move?", ["Glides like flying","Crawls on rocks","Jumps on land","Rolls"], 0)
  ),
  mkAnimal("Sea Lion","Ocean","ü¶≠", {size:6,str:6,spd:7}, "Whirlpool Spin", 0.98,
    "Sea lions are great swimmers and can move quickly underwater.",
    mkQuiz("Sea lion: Where is it especially fast?", ["Underwater","In the desert","In the sky","On lava"], 0)
  ),

  // BIRDS
  mkAnimal("Peregrine Falcon","Birds","ü¶Ö", {size:5,str:6,spd:10}, "Sky Dive Strike", 1.10,
    "Peregrine falcons are famous for extremely fast dives (the fastest dives among animals).",
    mkQuiz("Falcon: What is it famous for?", ["Fast dives","Digging","Swimming","Building dams"], 0)
  ),
  mkAnimal("Bald Eagle","Birds","ü¶Ö", {size:6,str:7,spd:7}, "Talon Grab", 1.02,
    "Eagles have powerful talons for grabbing prey.",
    mkQuiz("Eagle: What helps it grab things?", ["Talons","Horns","Hooves","Tentacles"], 0)
  ),
  mkAnimal("Owl","Birds","ü¶â", {size:4,str:5,spd:6}, "Silent Swoop", 0.98,
    "Owls can fly very quietly compared to many other birds.",
    mkQuiz("Owl: What‚Äôs special about its flight?", ["Very quiet","Always noisy","Only backwards","Only underwater"], 0)
  ),
  mkAnimal("Hummingbird","Birds","üê¶", {size:2,str:3,spd:10}, "Hover Jab", 0.92,
    "Hummingbirds can hover in place while feeding.",
    mkQuiz("Hummingbird: What can it do in mid-air?", ["Hover","Sleep-walk","Dig","Swim"], 0)
  ),
  mkAnimal("Cassowary","Birds","ü¶§", {size:7,str:8,spd:7}, "Dino Kick", 1.06,
    "Cassowaries are big, powerful birds‚Äîoften called ‚Äòdinosaur-like.‚Äô",
    mkQuiz("Cassowary: Why do people call it ‚Äòdinosaur-like‚Äô?", ["Big and powerful","It breathes fire","It has wheels","It is invisible"], 0)
  ),

  // REPTILES
  mkAnimal("Komodo Dragon","Reptiles","ü¶é", {size:7,str:8,spd:6}, "Rending Bite", 1.05,
    "Komodo dragons are the largest living lizards.",
    mkQuiz("Komodo: What‚Äôs a big claim about it?", ["Largest living lizard","Smallest bird","Fastest fish","Brightest plant"], 0)
  ),
  mkAnimal("King Cobra","Reptiles","üêç", {size:5,str:8,spd:7}, "Venom Feint", 1.03,
    "Cobras can spread a hood to look bigger and scary.",
    mkQuiz("Cobra: What can it spread to look bigger?", ["A hood","A cape","A sail","A shield"], 0)
  ),
  mkAnimal("Alligator","Reptiles","üêä", {size:8,str:9,spd:6}, "Clamp & Roll", 1.06,
    "Alligators can do a powerful ‚Äòdeath roll‚Äô in water.",
    mkQuiz("Alligator: What move is famous?", ["Clamp & roll","Moonwalk","Backflip","Teleport"], 0)
  ),
  mkAnimal("Chameleon","Reptiles","ü¶é", {size:3,str:3,spd:4}, "Tongue Snap", 0.90,
    "Chameleons can shoot out their tongues super fast to catch insects.",
    mkQuiz("Chameleon: What shoots out fast?", ["Tongue","Tail","Ears","Teeth"], 0)
  ),

  // AMPHIBIANS
  mkAnimal("Poison Dart Frog","Amphibians","üê∏", {size:2,str:4,spd:5}, "Toxic Touch", 0.92,
    "Some dart frogs have bright colors that warn predators: ‚ÄòDon‚Äôt eat me!‚Äô",
    mkQuiz("Dart frog: Why are some brightly colored?", ["Warning colors","To glow in the dark","To find treasure","To scare clouds"], 0)
  ),
  mkAnimal("Bullfrog","Amphibians","üê∏", {size:3,str:4,spd:5}, "Splash Lunge", 0.90,
    "Frogs can use strong back legs to leap.",
    mkQuiz("Frog: What helps it leap?", ["Strong back legs","Wings","Gills","Wheels"], 0)
  ),
  mkAnimal("Salamander","Amphibians","ü¶é", {size:3,str:3,spd:4}, "Slippery Escape", 0.88,
    "Some salamanders have slippery skin that can help them avoid predators.",
    mkQuiz("Salamander: What can help it escape?", ["Slippery skin","Jet engine","Armor plates","Sticky feet"], 0)
  ),

  // INSECTS & ARTHROPODS
  mkAnimal("Praying Mantis","Insects","ü¶ó", {size:2,str:5,spd:7}, "Snap Grab", 0.95,
    "Praying mantises have lightning-fast grabbing forelegs.",
    mkQuiz("Mantis: What is super fast?", ["Grabbing forelegs","Antlers","Wings made of stone","Shell"], 0)
  ),
  mkAnimal("Tarantula","Insects","üï∑Ô∏è", {size:3,str:6,spd:4}, "Hair Flick", 0.95,
    "Some tarantulas can flick itchy hairs to defend themselves.",
    mkQuiz("Tarantula: What defense can it use?", ["Flick itchy hairs","Fire breath","Ice shield","Bubble helmet"], 0)
  ),
  mkAnimal("Scorpion","Insects","ü¶Ç", {size:2,str:6,spd:5}, "Stinger Jab", 0.96,
    "Scorpions glow under ultraviolet (UV) light!",
    mkQuiz("Scorpion: What happens under UV light?", ["It can glow","It disappears","It grows wings","It turns into stone"], 0)
  ),
  mkAnimal("Giant Centipede","Insects","üêõ", {size:3,str:7,spd:7}, "Venom Pinch", 1.00,
    "Centipedes use venom claws (not jaws) to capture prey.",
    mkQuiz("Centipede: What does it use to inject venom?", ["Venom claws","A beak","A horn","A tail fin"], 0)
  ),

  // MORE VARIETY
  mkAnimal("Hippo","Land","ü¶õ", {size:9,str:9,spd:6}, "River Ram", 1.02,
    "Hippos spend lots of time in water to stay cool.",
    mkQuiz("Hippo: Why do they stay in water a lot?", ["To stay cool","To fly","To dig caves","To make honey"], 0)
  ),
  mkAnimal("Zebra","Land","ü¶ì", {size:6,str:5,spd:7}, "Stripe Sprint", 0.93,
    "Zebra stripes are unique‚Äîlike fingerprints.",
    mkQuiz("Zebra: What‚Äôs special about stripes?", ["Unique patterns","They are stickers","They are painted daily","They are invisible"], 0)
  ),
  mkAnimal("Polar Bear","Land","üêª‚Äç‚ùÑÔ∏è", {size:9,str:9,spd:6}, "Ice Breaker", 1.03,
    "Polar bears have thick fur and fat to handle cold climates.",
    mkQuiz("Polar bear: What helps with cold?", ["Thick fur and fat","Thin scales","Tiny feathers","No skin"], 0)
  ),
  mkAnimal("Hammerhead Shark","Ocean","ü¶à", {size:8,str:8,spd:7}, "Side-Sweep Bite", 1.04,
    "Hammerheads have wide heads that help them sense prey better.",
    mkQuiz("Hammerhead: What‚Äôs special about its head?", ["Wide shape","It‚Äôs square","It‚Äôs transparent","It‚Äôs detachable"], 0)
  ),
  mkAnimal("Electric Eel","Ocean","‚ö°üêü", {size:6,str:7,spd:6}, "Zap Burst", 1.03,
    "Electric eels can generate strong electric shocks.",
    mkQuiz("Electric eel: What can it generate?", ["Electric shocks","Windstorms","Fire","Snow"], 0)
  ),
  mkAnimal("Octopus","Ocean","üêô", {size:6,str:7,spd:6}, "Tentacle Tangle", 1.00,
    "Octopuses are known for being clever problem-solvers.",
    mkQuiz("Octopus: What is it known for?", ["Being clever","Being made of rock","Having feathers","Being a plant"], 0)
  ),
  mkAnimal("Peacock","Birds","ü¶ö", {size:4,str:3,spd:5}, "Fan Flare", 0.88,
    "Peacocks can fan out colorful tail feathers to impress.",
    mkQuiz("Peacock: What does it fan out?", ["Colorful tail feathers","A scarf","A shell","A horn"], 0)
  ),
  mkAnimal("Rattlesnake","Reptiles","üêç", {size:4,str:7,spd:6}, "Rattle Warning Strike", 1.02,
    "Rattlesnakes can warn with a rattling tail sound.",
    mkQuiz("Rattlesnake: How does it warn others?", ["Rattling tail sound","Singing","Clapping","Whistling"], 0)
  ),
  mkAnimal("Anaconda","Reptiles","üêç", {size:8,str:9,spd:5}, "Coil Crush", 1.05,
    "Big constrictor snakes squeeze to subdue prey.",
    mkQuiz("Big constrictors: How do they subdue prey?", ["Squeezing","Freezing","Tickling","Painting"], 0)
  ),
  mkAnimal("Honey Badger","Land","ü¶°", {size:4,str:7,spd:6}, "Fearless Frenzy", 1.00,
    "Honey badgers are famous for being very tough and bold.",
    mkQuiz("Honey badger: What reputation does it have?", ["Tough and bold","Always sleepy","Only eats ice","Only swims"], 0)
  ),
  mkAnimal("Giraffe","Land","ü¶í", {size:10,str:7,spd:6}, "Neck Swing", 0.98,
    "Giraffes have very long necks to reach high leaves.",
    mkQuiz("Giraffe: Why is its neck useful?", ["Reaching high leaves","Diving","Digging","Flying"], 0)
  ),
];

/* ============================
   Game state
   ============================ */
let stage = "select"; // select | battle | quiz
let picking = 1; // 1 then 2
let p1 = null, p2 = null;
let p1HP = 100, p2HP = 100;
let battleRunning = false;
let skipAnimation = false;
let battleFactsShown = []; // store quiz objects from animals used in battle (and move facts)
let usedQuizPool = [];
let quizState = { questions: [], answers: new Map(), score: 0, locked: false };

const el = (id)=>document.getElementById(id);

const selectionView = el("selectionView");
const battleView = el("battleView");
const quizView = el("quizView");

const stageTitle = el("stageTitle");
const stageDesc = el("stageDesc");
const pickHint = el("pickHint");
const animalGrid = el("animalGrid");
const categorySelect = el("categorySelect");
const searchInput = el("searchInput");

const startBattleBtn = el("startBattleBtn");
const skipBtn = el("skipBtn");
const randomBtn = el("randomBtn");
const resetBtn = el("resetBtn");

const fighter1 = el("fighter1");
const fighter2 = el("fighter2");
const battleLog = el("battleLog");
const turnHint = el("turnHint");

const quizWrap = el("quizWrap");
const quizScoreHint = el("quizScoreHint");
const playAgainBtn = el("playAgainBtn");
const picksSummary = el("picksSummary");

const toast = el("toast");

function mkAnimal(name, category, emoji, stats, moveName, movePower, funFact, quiz){
  return {
    id: slug(name),
    name, category, emoji,
    stats,
    move: { name: moveName, power: movePower, fact: funFact },
    quiz
  };
}
function mkQuiz(question, choices, answerIndex){
  return { question, choices, answerIndex };
}
function slug(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""); }

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 1600);
}

/* ============================
   Setup
   ============================ */
initCategoryOptions();
renderGrid();
syncRightPanel();
syncStageUI();

categorySelect.addEventListener("change", renderGrid);
searchInput.addEventListener("input", renderGrid);

randomBtn.addEventListener("click", ()=>{
  const pool = filteredAnimals();
  if(!pool.length) return showToast("No animals match that filter.");
  const pick = pool[Math.floor(Math.random()*pool.length)];
  if(picking===1 && p2 && pick.id===p2.id) return showToast("Try again ‚Äî Player 2 already picked that one.");
  if(picking===2 && p1 && pick.id===p1.id) return showToast("Try again ‚Äî Player 1 already picked that one.");
  chooseAnimal(pick);
});

resetBtn.addEventListener("click", resetAll);
playAgainBtn.addEventListener("click", resetAll);

startBattleBtn.addEventListener("click", ()=>{
  if(!p1 || !p2) return;
  startBattle();
});
skipBtn.addEventListener("click", ()=>{
  skipAnimation = true;
  skipBtn.disabled = true;
  showToast("Skipping animations!");
});

/* ============================
   Selection UI
   ============================ */
function initCategoryOptions(){
  const cats = Array.from(new Set(ANIMALS.map(a=>a.category))).sort();
  for(const c of cats){
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    categorySelect.appendChild(opt);
  }
}
function filteredAnimals(){
  const cat = categorySelect.value;
  const q = (searchInput.value||"").trim().toLowerCase();
  return ANIMALS.filter(a=>{
    const okCat = (cat==="All") || (a.category===cat);
    const okQ = !q || a.name.toLowerCase().includes(q) || a.category.toLowerCase().includes(q);
    return okCat && okQ;
  });
}

function renderGrid(){
  const list = filteredAnimals();
  animalGrid.innerHTML = "";
  for(const a of list){
    const card = document.createElement("div");
    card.className = "animalCard";
    if(p1 && a.id===p1.id) card.classList.add("selectedP1");
    if(p2 && a.id===p2.id) card.classList.add("selectedP2");
    card.innerHTML = `
      <div class="animalTop">
        <div class="emoji">${escapeHtml(a.emoji)}</div>
        <div class="tag">${escapeHtml(a.category)}</div>
      </div>
      <p class="animalName">${escapeHtml(a.name)}</p>
      <p class="move">Move: <b>${escapeHtml(a.move.name)}</b></p>
      <div class="stats">
        <div class="stat"><b>${a.stats.size}</b><span>Size</span></div>
        <div class="stat"><b>${a.stats.str}</b><span>Strength</span></div>
        <div class="stat"><b>${a.stats.spd}</b><span>Speed</span></div>
      </div>
    `;
    card.addEventListener("click", ()=> chooseAnimal(a));
    animalGrid.appendChild(card);
  }
}

function chooseAnimal(animal){
  if(stage!=="select") return;

  if(picking===1){
    if(p2 && animal.id===p2.id) return showToast("Player 2 already picked that one!");
    p1 = animal;
    picking = 2;
    showToast(`Player 1 picked ${animal.name}!`);
  } else {
    if(p1 && animal.id===p1.id) return showToast("Player 1 already picked that one!");
    p2 = animal;
    showToast(`Player 2 picked ${animal.name}!`);
  }
  renderGrid();
  syncRightPanel();
  syncStageUI();

  // if both picked, move to battle
  if(p1 && p2){
    stage = "battle";
    syncStageUI();
    buildBattleUI();
    showToast("Ready to battle!");
  }
}

function syncRightPanel(){
  picksSummary.innerHTML =
    `Player 1: <b>${p1 ? escapeHtml(p1.name) : "‚Äî"}</b><br/>` +
    `Player 2: <b>${p2 ? escapeHtml(p2.name) : "‚Äî"}</b>`;
}

function syncStageUI(){
  // view toggles
  selectionView.style.display = (stage==="select") ? "" : "none";
  battleView.style.display = (stage==="battle") ? "" : "none";
  quizView.style.display = (stage==="quiz") ? "" : "none";

  if(stage==="select"){
    stageTitle.textContent = "Stage 1: Choose animals";
    stageDesc.textContent = "Player 1 picks first, then Player 2. Use the filters to find animals quickly.";
    pickHint.innerHTML = `Now picking: <b>Player ${picking}</b>`;
  }
  if(stage==="battle"){
    stageTitle.textContent = "Stage 2: Battle!";
    stageDesc.textContent = "Watch the signature moves and fun facts. First health bar to hit zero loses.";
  }
  if(stage==="quiz"){
    stageTitle.textContent = "Stage 3: Quiz time!";
    stageDesc.textContent = "Answer 4 quick questions based on the fun facts you just saw.";
  }
}

/* ============================
   Battle
   ============================ */
function buildBattleUI(){
  p1HP = 100; p2HP = 100;
  battleRunning = false;
  skipAnimation = false;
  skipBtn.disabled = false;
  battleLog.innerHTML = "";
  turnHint.textContent = "Ready‚Ä¶";
  battleFactsShown = [];

  fighter1.innerHTML = fighterTemplate(p1, p1HP, "p1");
  fighter2.innerHTML = fighterTemplate(p2, p2HP, "p2");

  startBattleBtn.disabled = false;
}

function fighterTemplate(a, hp, side){
  const hpPct = Math.max(0, Math.min(100, hp));
  return `
    <div class="fighterTop">
      <div class="fighterName">
        <div class="emoji">${escapeHtml(a.emoji)}</div>
        <div>
          <div>${escapeHtml(a.name)}</div>
          <div class="mini">${escapeHtml(a.category)} ‚Ä¢ Move: ${escapeHtml(a.move.name)}</div>
        </div>
      </div>
      <div class="tag">${side==="p1" ? "Player 1" : "Player 2"}</div>
    </div>
    <div>
      <div class="hpbar"><div class="hpfill" style="width:${hpPct}%"></div></div>
      <div class="hptext"><span>HP</span><span><b>${Math.round(hpPct)}</b>/100</span></div>
    </div>
    <div class="stats">
      <div class="stat"><b>${a.stats.size}</b><span>Size</span></div>
      <div class="stat"><b>${a.stats.str}</b><span>Strength</span></div>
      <div class="stat"><b>${a.stats.spd}</b><span>Speed</span></div>
    </div>
  `;
}

function updateFighterUI(){
  fighter1.innerHTML = fighterTemplate(p1, p1HP, "p1");
  fighter2.innerHTML = fighterTemplate(p2, p2HP, "p2");
}

function logEntry(html){
  const div = document.createElement("div");
  div.className = "entry";
  div.innerHTML = html;
  battleLog.prepend(div);
}

function computeDamage(att, def){
  // Base from attacker stats
  const A = att.stats;
  const D = def.stats;

  const base = (A.str*0.52 + A.spd*0.32 + A.size*0.16) * 7; // 1..10 -> ~7..70
  // matchup bonuses (relative)
  const matchup =
    (A.spd / Math.max(1, D.spd)) * 0.35 +
    (A.str / Math.max(1, D.str)) * 0.45 +
    (A.size / Math.max(1, D.size)) * 0.20;

  const movePower = att.move.power;

  // a little randomness
  const rng = 0.88 + Math.random()*0.28; // 0.88..1.16

  let dmg = base * matchup * movePower * rng;

  // clamp for fun gameplay
  dmg = Math.max(6, Math.min(32, dmg));
  return Math.round(dmg);
}

function sleep(ms){
  return new Promise(res=>setTimeout(res, ms));
}

async function startBattle(){
  if(battleRunning) return;
  battleRunning = true;
  startBattleBtn.disabled = true;

  // seed quiz pool with the two animals' quiz questions
  usedQuizPool = [p1.quiz, p2.quiz].filter(Boolean);

  logEntry(`<b>Battle begins!</b><div class="meta">Two animals enter‚Ä¶ one animal wins üèÜ</div>`);

  let attacker = 1; // 1 then 2 alternating
  let turn = 1;

  while(p1HP>0 && p2HP>0){
    turnHint.textContent = `Turn ${turn}: Player ${attacker}'s move‚Ä¶`;

    const A = (attacker===1) ? p1 : p2;
    const D = (attacker===1) ? p2 : p1;
    const dmg = computeDamage(A, D);

    // apply
    if(attacker===1){
      p2HP = Math.max(0, p2HP - dmg);
    }else{
      p1HP = Math.max(0, p1HP - dmg);
    }

    // show fun fact in log
    logEntry(`
      <b>${escapeHtml(A.name)}</b> used <b>${escapeHtml(A.move.name)}</b> and dealt <b>${dmg}</b> damage!
      <div class="meta">‚ú® Fun fact: ${escapeHtml(A.move.fact)}</div>
    `);

    // collect quiz items from shown facts (use both animals if possible)
    battleFactsShown.push({
      animal: A.name,
      fact: A.move.fact,
      quiz: A.quiz
    });

    // UI update & hit animation
    updateFighterUI();
    const hitEl = (attacker===1) ? fighter2 : fighter1;
    hitEl.classList.add("hit");
    setTimeout(()=>hitEl.classList.remove("hit"), 380);

    if(!skipAnimation) await sleep(650);

    attacker = (attacker===1) ? 2 : 1;
    turn++;
    if(turn>60) break; // safety
  }

  const winner = (p1HP>p2HP) ? {player:1, animal:p1} : {player:2, animal:p2};
  const loser  = (winner.player===1) ? {player:2, animal:p2} : {player:1, animal:p1};

  turnHint.textContent = `Winner: Player ${winner.player}!`;
  logEntry(`<b>üèÜ Winner: Player ${winner.player} ‚Äî ${escapeHtml(winner.animal.name)}!</b>
            <div class="meta">${escapeHtml(loser.animal.name)} has run out of HP.</div>`);

  // Move to quiz
  await sleep(skipAnimation ? 200 : 650);
  stage = "quiz";
  syncStageUI();
  buildQuiz();
}

/* ============================
   Quiz
   ============================ */
function buildQuiz(){
  quizState = { questions: [], answers: new Map(), score: 0, locked: false };
  quizWrap.innerHTML = "";

  // Build question pool from animals used (their quiz objects), plus extra facts from battle log.
  // We keep it simple: pick from unique quiz objects.
  const pool = [];
  const seenQ = new Set();

  for(const item of battleFactsShown){
    if(item.quiz && item.quiz.question && !seenQ.has(item.quiz.question)){
      seenQ.add(item.quiz.question);
      pool.push(item.quiz);
    }
  }

  // If pool too small, top up from global list (still kid-friendly)
  // but try to keep it about the selected animals first.
  if(pool.length < 4){
    for(const a of ANIMALS){
      if(a.quiz && !seenQ.has(a.quiz.question)){
        pool.push(a.quiz);
        seenQ.add(a.quiz.question);
      }
      if(pool.length >= 10) break;
    }
  }

  shuffle(pool);
  quizState.questions = pool.slice(0,4);

  quizScoreHint.textContent = `Score: 0 / 4`;

  quizState.questions.forEach((q, idx)=>{
    const qEl = document.createElement("div");
    qEl.className = "quizQ";
    qEl.innerHTML = `
      <h3>Q${idx+1}. ${escapeHtml(q.question)}</h3>
      <div class="options" id="qopts-${idx}"></div>
    `;
    quizWrap.appendChild(qEl);

    const opts = qEl.querySelector(`#qopts-${idx}`);
    q.choices.forEach((choice, cidx)=>{
      const o = document.createElement("div");
      o.className = "opt";
      o.textContent = choice;
      o.addEventListener("click", ()=> answerQuestion(idx, cidx, o, opts));
      opts.appendChild(o);
    });
  });

  // If something went wrong
  if(quizState.questions.length < 4){
    quizWrap.innerHTML = `<div class="hint">Not enough quiz questions found. Add more quiz entries in the data section.</div>`;
  }
}

function answerQuestion(qIndex, choiceIndex, optEl, optsWrap){
  if(quizState.locked) return;
  if(quizState.answers.has(qIndex)) return; // already answered

  const q = quizState.questions[qIndex];
  const correct = (choiceIndex === q.answerIndex);

  quizState.answers.set(qIndex, choiceIndex);

  // mark options
  const children = Array.from(optsWrap.children);
  children.forEach((node, idx)=>{
    if(idx === q.answerIndex) node.classList.add("correct");
    if(idx === choiceIndex && !correct) node.classList.add("wrong");
    node.style.pointerEvents = "none";
  });

  if(correct) quizState.score++;
  quizScoreHint.textContent = `Score: ${quizState.score} / 4`;

  // if finished
  if(quizState.answers.size === 4){
    quizState.locked = true;
    const msg = (quizState.score === 4) ? "Perfect score! üß†‚ú®"
              : (quizState.score >= 3) ? "Awesome! üåü"
              : (quizState.score >= 2) ? "Nice work! üëç"
              : "Good try! Want a rematch? üôÇ";
    showToast(msg);

    // show summary at bottom
    const sum = document.createElement("div");
    sum.className = "hint";
    sum.style.marginTop = "10px";
    sum.innerHTML = `<b>Final quiz score:</b> ${quizState.score} / 4`;
    quizWrap.appendChild(sum);
  }
}

/* ============================
   Reset
   ============================ */
function resetAll(){
  stage = "select";
  picking = 1;
  p1 = null; p2 = null;
  p1HP = 100; p2HP = 100;
  battleRunning = false;
  skipAnimation = false;
  battleFactsShown = [];
  usedQuizPool = [];
  quizState = { questions: [], answers: new Map(), score: 0, locked: false };

  searchInput.value = "";
  categorySelect.value = "All";
  renderGrid();
  syncRightPanel();
  syncStageUI();
  showToast("Restarted!");
}

/* ============================
   Helpers
   ============================ */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>
</body>
</html>
